---
title: "HW Assignment 5"
author: "Cindy Chenr"
date: "`r Sys.Date()`"
output: pdf_document
---

1. (2 points) Recall the obesity problem from Homework 1. The data are as follows:
CVD Death
Yes No
Obese 16 2045
Not obese 7 1044
Using Poisson log linear regression, test for independence between obesity and CVD death outcome.
(Hint: this is equivalent to testing that the interaction term in the model is zero.) How does your answer
compare to a chi-square test on the same data?

```{r}
CVD_Death_df <- data.frame(
  Obese = rep(c("Obese", "Not obese"), times = c(2, 2)),
  CVD_Death = rep(c("Yes", "No"), each = 1),
  Count = c(16, 2045, 7, 1044)
)
CVD_Death_df


```

```{r}


model <- glm(Count ~ Obese * CVD_Death, family = poisson(link = "log"), data = CVD_Death_df)

summary(model)
```
```{r}

contingency_table <- matrix(c(16, 2045, 7, 1044), nrow = 2, byrow = TRUE)
dimnames(contingency_table) <- list(c("Obese", "Not obese"), c("CVD Death Yes", "CVD Death No"))
print(contingency_table)


```
```{r}
chi_squared_test <- chisq.test(contingency_table)
print(chi_squared_test)
```


Answer:

From the Poisson log-linear regression model results p-value = 0.734 indicate 
that the interaction between obesity and CVD death outcome is not statistically 
significant, with a p-value of 0.734. This suggests that there is no evidence of 
an association between obesity and CVD death outcome after accounting for the 
main effects of obesity and CVD death.

On the other hand, the chi-square test for independence yields a p-value of 
0.9057, which also suggests that there is no significant association between 
obesity and CVD death outcome.

Therefore, both the Poisson log-linear regression model and the chi-square test 
provide same evidence that there is no significant association between obesity 
and CVD death outcome in the data.


2. (3 points) Although male elephants are capable of reproducing by 14 to 17 years of age, younger adult
males are usually unsuccessful in competing with their larger elders for the attention of receptive females.
Since male elephants continue to grow throughout their lifetimes, and since larger males tend to be more
successful at mating, the males most likely to pass their genes to future generations are those whose
characteristics enable them to live long lives. Joyce Poole studied a population of African elephants in
Amboseli National Park, Kenya, for 8 years. You can explore this data set in case2201 in the Sleuth3
library. This data frame contains the number of successful matings and ages (at the studyâ€™s beginning)
of 41 male elephants.
Give an estimated model for describing the number of successful matings as a function age, using
(a) simple linear regression after taking a square root transformation of the number of successful matings;

```{r}
library(Sleuth3)
data(case2201)
head(case2201)
```
```{r}
case2201$sqrt_success <- sqrt(case2201$Matings)
model_1 <- lm(sqrt_success ~ Age, data = case2201)
summary(model_1)
```
```{r}
plot(residuals(model_1) ~ fitted(model_1), main = "Residuals vs Fitted (Square Root Model)")
abline(h=0, col="blue")
```
```{r}
df_residual <- summary(model_1)$df[2]
sqrt_df <- sqrt(df_residual)
print(sqrt_df)
```
Answer:

The residual standard error (0.6493) is not substantially larger than the square 
root of the degrees of freedom (approximately 6.245), it suggests that there is 
no strong evidence of overdispersion in linear regression model.


(b) simple linear regression after taking a logarithmic transformation (after adding 1);

```{r}
case2201$log_success <- log(case2201$Matings + 1)


model_2 <- lm(log_success ~ Age, data = case2201)


summary(model_2)
```
```{r}
plot(residuals(model_2) ~ fitted(model_2), main = "Residuals vs Fitted (Log Transform Model)")
abline(h=0, col="blue")
```
```{r}
df_residual_2 <- summary(model_2)$df[2]
sqrt_df_2 <- sqrt(df_residual_2)
print(sqrt_df_2)
```

Answer:

The residual standard error (0.5237) is not substantially larger than the square 
root of the degrees of freedom (approximately 6.245), it suggests that there is 
no strong evidence of overdispersion in linear regression model.

(c) log-linear regression.
Be sure to examine residuals from each of these models. How do the models compare? Please be specific.
Is there evidence of over dispersion? If so, fit another model and report results from that model. If not,
why not?

```{r}
log_model <- glm(Matings ~ Age, family = poisson, data = case2201)
summary(log_model)
```
```{r}
plot(residuals(log_model) ~ fitted(log_model), main = "Residuals vs Fitted (Log-Linear Model)")
abline(h=0, col="blue")
```
```{r}
dispersion_loglinear <- sum(residuals(log_model, type = "pearson")^2) /
  log_model$df.residual
print(paste("Dispersion in Log-Linear Model:", dispersion_loglinear))
```
Answer:
Dispersion in Log-Linear Model: 1.1573343230281 > 1, it suggests that there is 
strong evidence of overdispersion in linear regression model.


Conceptual Questions
3. (2 points) What is the dierence between a log-linear model and a linear model after the log transformation of the response?

Answer:
In linear model, the assumption is that the relationship between independent 
variables and dependent variables would be linear. It means that if there is a
change in the independent variables, it will leads to a constant change in the
dependent variable.

A log-linear takes the logarithm of the dependent variables and then fitting a 
linear model to the transformed data. It is usually done when the relationship
between the variables is multiplicative rather than additive.

In summary, in linear model, the independent variables are used directly; in 
log-linear model, it undergoes a logarithmic transformation before modeling.


4. (3 points) This question refers to the elephant mating data from question 2 above.
(a) Both the binomial and the Poisson distributions provide probability models for random counts.
Which distribution is more appropriate to model the number of successful matings for male African
elephants, and why?

Answer:

Poisson distribution is more properly.
It will based on few factors:
1) Nature of the process: Elephant matings could be considered as randomly and 
independently over time.
2) Occurrence rate is constant: The probability of success may vary between
individual elephants. However, over a large population and timeframe, the average
rate of successful mating might becomes more constant.
3) Number of Trails is not fixed: In binomial scenario, there is a fixed number 
of trails. However, there is not a predetermined number of opportunities for
successful matings for a make elephant. As mating process continue over time, 
it will make the poisson distribution more suitable.


(b) In the following plot, we see that the spread of responses is larger for larger values of the mean
response. Is this something to be concerned about if we perform a Poisson log-linear regression?

Answer:
If the spread of responses increases as the mean response increase, it indicates
overdispersion. It means that the variability in the data larger than what is 
expected by the poisson distribution. 



(c) Performing a Poisson log-linear regression results in the following output:
Estimate Std. Error z value Pr(> |z|)
(Intercept) -1.58201 0.54462 -2.905 0.00368 **
Age 0.06869 0.01375 4.997 5.81e-07 ***
Residual Deviance: 51.01 on 39 degrees of freedom
What are the mean and variance of the distribution of counts of successful matings (in 8 years) for
elephants who are aged 25 years at the beginning of the observation period? What are the mean
and variance for elephants who are aged 45 years?

Answer:
```{r}

intercept <- -1.58201
age_coefficient <- 0.06869


log_linear_regression <- function(age) {
  lambda <- exp(intercept + age_coefficient * age)
  return(c(mean = lambda, variance = lambda))
}


age_25 <- log_linear_regression(25)


age_45 <- log_linear_regression(45)


print("For elephants aged 25 years:")
print(paste("Mean:", age_25["mean"]))
print(paste("Variance:", age_25["variance"]))

print("For elephants aged 45 years:")
print(paste("Mean:", age_45["mean"]))
print(paste("Variance:", age_45["variance"]))

```
Answer:
When the elephant is 25 years, the mean is 1.14481150614486 and variance is
1.14481150614486; when the elephant is 45 years, the mean is 4.52238721800193 and 
variance is 4.52238721800193.

