---
title: "Module 5 HW Submission"
author: Cindy Chen
output:
  pdf_document:
    latex_engine: xelatex 
    
---


1. Recall the Lab 5 data and models:
Model 1: Both birds and non-echolocating bats have possibly different energy costs in flight to echolocating bats, after accounting for a linear relationship between log energy and log mass,

log(Energyi) = β0 + β1 log(Massi) + β2non-ebati + β3birdi + i

Model 2: The energy costs for non-echolocating bats and echolocating bats is the same, but possibly
different to birds, after accounting for a linear relationship between log energy and log mass,
log(Energyi) = β0 + β1 log(Massi) + β3birdi + i

(a) (2 points) Use these two models to demonstrate that the Extra Sum of Squares F-test comparing
models that only differ by one parameter is equivalent to a t-test of that parameter, and that the
F-statistic is the t-statistic squared.

```{r}
library(broom)
library(ggplot2)
library(MASS)
library(Sleuth3)
```
```{r}
head(case1002)
?case1002
```
```{r}
model1 <- lm(log(Energy) ~ log(Mass) + Type, data = case1002)
summary_model1 <- summary(model1)
summary_model1
```

```{r}
model2 <- lm(log(Energy) ~ log(Mass) + 
    I(Type == "non-echolocating birds"), data = case1002)
summary_model2 <- summary(model2)
summary_model2
```
```{r}
# Perform ESS F-test
ess_test <- anova(model1, model2)
ess_test
```
```{r}
rss1 <- deviance(model1) # Model 1 RSS
rss2 <- deviance(model2) # Model 2 RSS
df1 <- df.residual(model1) # Model 1 Residual Degrees of Freedom
df2 <- df.residual(model2) # Model 2 Residual Degrees of Freedom
fstat <- ((rss2 - rss1)/(df2 - df1))/(rss1/df1) # F-statistic
fstat
1 - pf(fstat, df2 - df1, df2) # p-value
```




(b) (2 points) Consider these two model specified in R’s lm() notation:
lm(log(Energy) ~ log(Mass), data = case1002)
lm(log(Energy) ~ log(Mass) + Type, data = case1002)
Describe in non-technical terms, (i.e. to someone who doesn’t use R), why these two models, that
look like they only differ by one parameter, cannot be compared with a single t-test.

Answer:
Model1: The model shows the relationship between log of energy and log of mass which follows a 
certain pattern. The pattern is a strgiaht line when we don't consider any other factor.

Model2: The model shows there are 2 factors: log of mass and type have impact on the log of energy. 

Model2 has additional factor: TYpe need to be considered. The single t-test would not be appropriate 
because the t-test would only be able to evaluate the difference in one specific parameter. Morever, 
the addition of "Type" variable changes the scope and interpretation of the model which makes the model
fundamentally different.



2. (6 points) Consider the data ex1014 in the Sleuth3 package. The data describes an experiment in
which researchers randomly allocated 25 beakers containing minnow larvae to treatment combinations
of zinc and copper. After four days, the minnows in each beaker were measured for their protein levels.

```{r}
library(Sleuth3)
head(ex1014)

```

(a) Create a plot of protein against zinc, with points colored by the level of copper, and a plot of protein
against copper, with points colored by the level of zinc. Describe any relationships you see.

```{r}
library(ggplot2)
ggplot(ex1014, aes(x = Zinc, y = Protein, color = factor(Copper))) +
  geom_point() +
  labs(title = "The relationship between Iron Protein vs Zinc",
       x = "Zinc",
       y = "Protein")
```
Answer:
As the Zinc increase, Protein decrease trending. From the chart, we make assumption
that there is negative relationship between Zinc and Protein.

```{r}
library(ggplot2)
ggplot(ex1014, aes(x = Copper, y = Protein, color = factor(Zinc))) +
  geom_point() +
  labs(title = "The relationship between Copper vs Protein",
       x = "Copper",
       y = "Protein")
```
Answer:
From the chart, we could make assumption that Copper doesn't have any impact on
Protein. However, we will need to have more dataset to approve our assumptions.



(b) Fit a model for protein that includes both main and interaction terms for Zinc and Copper. Examine
the residual plots and comment on the validity of the assumptions.

```{r}
full_model <- lm(Protein ~ Zinc + Copper + Zinc : Copper, data = ex1014)
full_model
```
```{r}
summary(full_model)
```
```{r}
residuals <- residuals(full_model)
residuals
```
```{r}
plot(ex1014$Zinc, residuals(full_model), xlab = "Zinc", ylab = "Residuals")

```


```{r}
plot(ex1014$Copper, residuals(full_model), xlab = "Copper", ylab = "Residuals")
```


Answer: 
Here is the full model result: Protein = 211.3 − 0.06520 × Zinc - 0.3398 × Copper 
+ 0.0002727 × Zinc × Copper

From the result a p-value of 5.21e-06. This suggests that there is evidence to 
reject the null hypo that the true coefficient is 0 which means that the 
interaction between Zinc and Copper levels has a significant effect on the mean 
protein level.

From the both plot chart above, we could make a conclusion that the residuals are 
randomly distributed around 0 and exhibit no clear pattern or trend as the 
predictor variable (Zinc) or (Copper) changed and consistent residuals across
different values of Zinc or Copper. It suggests that the model is capturing the
relationship between the predictor and response variables adequately.


(c) Fit a model for log protein that includes both main and interaction terms for Zinc and Copper.
Examine the residual plots and comment on the validity of the assumptions. Is there evidence the
model on the log scale better satisfies the assumptions?


```{r}
log_model <- lm(log(Protein) ~ Zinc + Copper + Zinc : Copper, data = ex1014)
summary(log_model)
```
```{r}
residuals <- residuals(log_model)
residuals
```
```{r}
plot(ex1014$Zinc, residuals(log_model), xlab = "Zinc", ylab = "Residuals")
```
```{r}
plot(ex1014$Copper, residuals(log_model), xlab = "Copper", ylab = "Residuals")
```


Answer:
Here is the log model result: Protein = 5.382 − 0.0004177 X Zinc - 0.00273 X 
Copper + 0.000001633 × Zinc × Copper

The p value in log model is 1.105e-05 is greater than the P values in full model 
is 5.21e-06 which suggest that weaker evidence against the null hypo
compared to the latter.

When the log model compares with the full model, the residual values becomes
smaller which indicated that model's predictions are close to the observed values.
It means that the model is doing a better job of explaining the variability in 
the data.

(d) Conduct a test for the interaction term in the model in (b). Make sure you completely
specify your model, hypotheses, test statistic and p-value. Write a short non-technical summary
based on your result in the context of the study.

$$
H0:Interaction term (Zinc:Copper)=0
$$
$$
H1:Interaction term (Zinc:Copper) <> 0
$$
```{r}
# Fit the linear model with main and interaction term
full_model <- lm(Protein ~ Zinc + Copper + Zinc : Copper, data = ex1014)

# Fit reduced model
reduce_model <- lm(Protein ~ Zinc + Copper, data = ex1014 )

# Perform the F-test
anova_result_V1 <- anova(full_model, reduce_model)
anova_result_V1
```
```{r}
p_value <- anova_result_V1$'Pr(>F)'[2]
p_value
```

Answer: From the result, the p value = 0.04153469 is less than 0.05 indicates that
we have enough evidence to suggest that there is a statistically significant 
interaction effect between Zinc and Copper on the level of protein.



(e) Produce mean protein levels, along with confidence intervals, for all combinations of Zinc and
Copper based on the model in (b). Describe the effect of the interaction between Zinc and Copper
on mean protein. (Hint: making a plot of these predictions might help).

```{r}
predictions <- predict(full_model, newdata = expand.grid(Zinc = unique(ex1014$Zinc), 
        Copper = unique(ex1014$Copper)), interval = "confidence", level = 0.95)
predictions
```
```{r}
predictions[, 1]
```
```{r}
predictions[, 2]
```
```{r}
predictions[, 3]
```


```{r}
summary(predictions)
```

```{r}
# creates a vector where each unique value of Zinc is repeated for each unique value of Copper
predictions_df <- data.frame(Zinc = rep(unique(ex1014$Zinc), length(unique(ex1014$Copper))),
                              Copper = rep(unique(ex1014$Copper), each = length(unique(ex1014$Zinc))),
                              Predict_Protein = predictions[, 1],
                              CI_lower = predictions[, 2],
                              CI_upper = predictions[, 3])

# Plot predict protein levels along with confidence intervals
library(ggplot2)
ggplot(predictions_df, aes(x = Copper, y = Predict_Protein, color = factor(Zinc), group = factor(Zinc))) +
  geom_line() +
  geom_point() +
  labs(title = "The relationship between Predict Protein Levels by Zinc and Copper",
       x = "Copper",
       y = "Predict Protein",
       color = "Zinc") +
  theme_minimal()
```



(f) Try fitting a model where the levels of both Zinc and Copper are treated as categories, and include
an interaction between the now categorical Zinc and Copper. Examine the model. Describe the
problem with this model that prevents inference from proceeding.

```{r}
categorical_model <- lm(Protein ~ factor(Zinc) +  factor(Copper) + factor(Zinc) : factor(Copper), data = ex1014)
summary(categorical_model)
```
Answer:
This approach might encounter a "overfitting". The reason why is that the model 
become too complex and it will capture noise in the data rather than meaningful
patterns. It means that the model perform too well on the training data but it will
do poorly on the validation datasets.

From the summary, we could see that the result didn't tell us any meaningful
result. The reason might be with a large number of categorical levels and 
interactions, it makes the coefficients become difficult to interpret.







