---
title: "Module 6 HW Submission"
author: Cindy Chen
output:
  pdf_document:
    latex_engine: xelatex 
---
 

```{r}
library(faraway)
?pima
head(pima)

```
(a) (2 points) It has been suggested that the zeros in diastolic, glucose, triceps, insulin and bmi
are actually missing values. Replace these zeros with NAs and describe (quantitatively, visually, and
in words) the distribution of missing values in the data.


```{r}

library(dplyr)
library(ggplot2)

pima_NA <- pima |>
  mutate(across(c(diastolic, glucose, triceps, insulin, bmi),  ~replace(., . == 0, NA)))
head(pima_NA)
```
```{r}
summary(is.na(pima_NA))
```


```{r}
missing_values_count = colSums(is.na(pima_NA))
missing_values_count
```


```{r}
missing_values <- data.frame(
  column = names(pima_NA),
  missing_values_count = colSums(is.na(pima_NA))
)
head(missing_values)
```

```{r}

ggplot(missing_values, aes(x = column, y = missing_values$missing_values_count)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(title = "Number of Missing Values in Each Attributes",
       x = "Attributes Name",
       y = "Number of Missing Values")
```
Answer: From the summary and bar chart we can see that insulin columns has the 
highest NA values: 374; the second highest NA values: 227; diastolic NA:35;
bmi NA: 11; glucose NA: 5.


(b) (1 point) Suggest, in the context of the study, a mechanism such that the missing values in
diastolic might be considered missing completely at random.

Answer:
1) The missing values in diastolic could be data entry errors.
2) The machine or the equipment which used to measure diastolic blood pressure
   randomly fail.
3) These are random erros in the diastolic blood pressure measurement device 
   cause some recorded measurements are missing.
   
(c) (1 point) Suggest, in the context of the study, another mechanism such that the missing values in
diastolic might be considered missing not at random.

Answer:
1) Participants with high diastolic blood pressures are unlikely to participate in
the study.
2) The device is not accurate and it is underestimate diastolic blood pressures
for the one who has higher diastolic blood pressures.
3) Participants with higher diastolic blood pressure are refuce to make their
blood pressure shows high.


(d) (2 points) Fit a linear model with diastolic as the response and the other variables as predictors.
Summarize the fit.

```{r}
head(pima_NA)
```



```{r}
origMod <- lm(diastolic ~ pregnant + glucose + triceps + insulin + bmi + 
                diabetes + age + test, data=pima_NA)
summary(origMod)
```
(e) (2 points) Use mean value imputation for the missing values, and refit the model. Compare the
resulting estimates to the estimates from the previous fit: are the coefficient estimates similar, or
do they differ substantially?

```{r}

pima_mean <- pima |>
  mutate(across(c(diastolic, glucose, triceps, insulin, bmi),  
                ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))
head(pima_mean)
```

```{r}
origMod_v2 <- lm(diastolic ~ pregnant + glucose + triceps + insulin + bmi + 
                diabetes + age + test, data=pima_mean)
summary(origMod_v2)
```
```{r}
coefficients_origMod <- coef(origMod)
coefficients_origMod
```
```{r}
coefficients_origMod_v2 <- coef(origMod_v2)
coefficients_origMod_v2
```
Answer:

From the above result, we can see that the coefficient shows different between
the two models and even shows significantly different for few attributes. The
reason why is how we handle 0 values by using NA or mean which has significantly
impact on the model.



(f) (2 points) Use multiple imputation to handle missing values and fit the same model again. Compare
the resulting estimates to the estimates from the previous two models (with no imputation, and
with mean imputation): are the coefficient estimates similar, or do they differ substantially?

```{r}
summary(is.na(pima_NA))
```


```{r}
library(Amelia)
set.seed(123)

n.imp <- 25 
pima_mutiple <- amelia(pima_NA, m=n.imp, p2s=0)

```




```{r}
betas <- matrix(0, nrow=n.imp, ncol=9)
ses <- matrix(0, nrow=n.imp, ncol=9)
```


```{r}
for(i in 1:n.imp){
  origMod <- lm(diastolic ~ pregnant + glucose + triceps + insulin + bmi + 
                diabetes + age + test, data=pima_mutiple$imputations[[i]])
  betas[i,] <- coef(origMod)
  ses[i,] <- coef(summary(origMod))[,2]
}
```

```{r}
mi.meld(q=betas, se=ses)
```
Answer:
The model result shows different than other 2 model. 
The reason why might be:
1) MI accounts for uncertainty associated with missing data by creating multiple
imputed datasets which lead to more accurate result.
2) More different models to each imputed datasets which capture different aspects
of the data.



