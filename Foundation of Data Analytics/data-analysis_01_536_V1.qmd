---
title: "536: A Comparison of Expenditure on Intercollegiate Athletics"
author: Cindy Chen
format: pdf
---

```{r, echo=FALSE, results='hide'}
#| include: false
library(tidyverse)
library(dplyr)
# install.packages("ggplot2")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
# Set the relative path to the zip file
zip_path <- "data-analysis_01_536.zip"

# Specify the relative path to the sports CSV file within the zip archive
csv_path <- "data-analysis_01_536/sports.csv"

# Open a connection to the CSV file within the zip archive
zip_connection <- unz(zip_path, csv_path)

# Read the CSV file with the identified header row using read.csv
data <- read.table(zip_connection, header = TRUE, sep = ",", fill = TRUE, skipNul = TRUE)


# Display the data
head(data)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
# Display all the column names
column_names <- colnames(data)
column_names
```



```{r, echo=FALSE, message=FALSE, warning=FALSE,results='hide'}
# Convert relevant columns to numeric
data <- mutate(data,
               enroll_women = as.integer(as.numeric(enroll_women, na.rm = TRUE)),
               enroll_men =  as.integer(as.numeric(enroll_men, na.rm = TRUE)),
               expense_women =  as.integer(as.numeric(expense_women, na.rm = TRUE)),
               expense_men =  as.integer(as.numeric(expense_men, na.rm = TRUE)),
               revenue_women =  as.integer(as.numeric(revenue_women, na.rm = TRUE)),
               revenue_men =  as.integer(as.numeric(revenue_men, na.rm = TRUE)),
               partic_women =  as.integer(as.numeric(partic_women, na.rm = TRUE)),
               partic_men =  as.integer(as.numeric(partic_men, na.rm = TRUE))
)

head(data)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
# Create the new columns
# data <- filter(data, institution != 0)
sport_summary <- data |>
  filter(institution != "0") |>
  group_by(institution) |>
  summarise(
    total_expense = sum(expense_women + expense_men, na.rm = TRUE),
    total_women = sum(expense_women, na.rm = TRUE),
    prop_women = total_women / total_expense
  )

# sport_summary


```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Q1: What proportion of the expenditures at institutions go towards the womens’ teams?
sport_summary <- sport_summary |>
  filter(is.finite(prop_women))
sport_summary$prop_women <- round(sport_summary$prop_women, 2)

ggplot(sport_summary, aes(x = prop_women)) +
  geom_histogram(breaks = seq(0, 1, by = 0.1), position = "dodge", fill = "black", color = "white") +
  labs(
    title = "Proportion of Women in Teams by Institution",
    x = "Proportion Women",
    y = "Count"
  )


```
Q1 Conclusion:
From the chart we could see that the distribution Proportion of Women in Teams 
by Institution like normal distribution. Besides prop = 0 or 1, it might be 
outiers since it has the lower number. Around p = 0.5, it has the highest number. 
Most of the institution's expendituresproportion is between 0.4 and 0.6.


```{r, echo=FALSE, message=FALSE, warning=FALSE,results='hide'}
# Q2: Of the sports that have both men’s and women’s teams, which sports have 
# the biggest difference in the expenditure per player between men and women?

# 1) Filter and add columns
data_Q2 <- data |> 
  filter(partic_men > 0) |>
  filter(partic_women > 0) |>
  mutate(
    expense_per_player_women = round((expense_women / partic_women),2),
    expense_per_player_men = round((expense_men / partic_men),2),
    expense_diff = round((expense_per_player_women - expense_per_player_men),2)
  )
# data_Q2
         
```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
# 2) Create a scatter plot for expense_diff with different colors for women and men

options(scipen = 999)
# Create a scatter plot for the difference in per player expenditure
ggplot(data_Q2, aes(x = sport, y = expense_diff, color = sport)) +
  geom_point(position = position_dodge(width = 0.8)) +
  labs(
    title = "Expense Diff By Sport and Institution Per Player",
    x = "Sport",
    y = "Expense Diff Per Player",
    color = "Institution"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  guides(color = FALSE)

```

Q2: Create plot
a, Basketball has the big values on average, golf and tennis have relatively big 
values on average.
b, Basketball has big values on spread, Golf and Tennis has relatively big 
spread on average as well. The rest like Bowling, Fencing, etc has small 
spread on average.



```{r, echo=FALSE, message=FALSE, warning=FALSE}

# 3) Compute summary: summarise by sport to compute the mean of expense_diff
data_Q2 |>
  group_by(sport) |>
  summarise(
    avg_diff = mean(abs(expense_diff), na.rm = TRUE)
  ) |>
  ggplot(aes(x = sport, y = avg_diff, color = sport)) +
  geom_point(position = position_dodge(width = 0.8)) +
  labs(
    title = "Average Difference in Expenditure per Player (Men - Women) by Sport",
    x = "Sport",
    y = "Average Difference in Expenditure per Player"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))  +
  guides(color = FALSE)


```
Q2: Compute summary
From the chart, we could see that the average (across institutions) 
difference in expenditure per player between men and women is 0 and 40000
across all the sports. There are outliers in the chart which is basketball and
gymnastics; the rest of the sports about the average (across institutions) 
difference is between 0 and 15000.


```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(flextable)

data_Q2 <- data_Q2 |>
  group_by(sport) |>
  summarise(
    avg_diff = mean(abs(expense_diff), na.rm = TRUE)
  ) |>
  arrange(desc(avg_diff)) |>
  head(5) |>
  flextable()

# Print or view the table
print(data_Q2)

```

Q2: Identify sports and produce table
In this summary chart, it lists the top 5 highest avg diff for all
the sports. 1st: Gymnastics, avg_diff = 39,614.540; 2nd: Basketball, avg_diff = 
38,844.317; 3rd: Golf, avg_diff = 13,859.409; 4th: Ice Hockey, avg_diff = 
8,221.439; 5th: Tennis, avg_diff = 8,129.785.






